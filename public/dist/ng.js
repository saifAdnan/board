"use strict";var app=function(){return app=angular.module("myApp",["ngRoute"],["$interpolateProvider",function(a){a.startSymbol("{%"),a.endSymbol("%}")}]),app.run(["$rootScope",function(a){a.hello="Hello World"}]),app.config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"public/partials/home.html",controller:"mainCtrl"}),b.html5Mode(!1).hashPrefix("!")}]),app}();!function(a){var b=function(a){a.hello="hello world world!!!!",a.any=!0};b.$inject=["$scope"],a.controller("mainCtrl",b)}(app),EMRAppointmentSchedulerView.controller("AppointmentSchedulerViewController",["$scope","$http","$location","$state","AppointmentSchedulerService","ModalPopupService","$compile",function(a,b,c,d,e,f,g){var h=$("#calendar");a.apptSchedulerSelectedPhysicianResourceID=EMRPracticeModel.LoggedUserID,a.apptSchedulerPhysicianOrResourceType=1,a.apptCurrentDate=new Date,a.apptCurrentView="agendaDay",a.apptStartDate="",a.apptEndDate="",a.apptMinTime="08:00:00",a.apptMaxTime="20:00:00",a.apptSlotDuration="00:15:00",a.AppointmentSchedulerHeading="Appointment Scheduler",a.ApptSchedView_GetFacilitiesToBeShownInApptSchdulerList=function(){e.ApptSchedView_GetFacilitiesToBeShownInApptSchdulerList().then(function(b){for(a.ApptSchedView_FacilitiesList=b,a.ElementIndex=0;a.ElementIndex<=a.ApptSchedView_FacilitiesList.length-1;a.ElementIndex++)if(a.ApptSchedView_FacilitiesList[a.ElementIndex].FacilityID==EMRPracticeModel.LoggedFacilityID){a.SelectedAppointmentFacility=a.ApptSchedView_FacilitiesList[a.ElementIndex];break}a.ApptSchedView_GetPhysicianAndResourceList()})},a.ApptSchedView_GetPhysicianAppointments=function(){var b,c=a.apptCurrentDate;a.apptStartDate=c,a.apptEndDate=c;var d;"month"==a.apptCurrentView?(d=c.getMonthStartAndEndDays(),a.apptStartDate=d[0],a.apptEndDate=d[1]):"agendaWeek"==a.apptCurrentView?(d=c.getWeekStartAndEndDays(),a.apptStartDate=d[0],a.apptEndDate=d[1]):(a.apptStartDate=c,a.apptEndDate=c),void 0!=a.SelectedAppointmentFacility&&void 0!=a.SelectedAppointmentFacility.FacilityID&&a.SelectedAppointmentFacility.FacilityID>0&&(b=a.SelectedAppointmentFacility.FacilityID),e.ApptSchedView_GetPhysicianAppointments(a.apptStartDate,a.apptEndDate,a.apptSchedulerSelectedPhysicianResourceID,b,!1,a.apptSchedulerPhysicianOrResourceType).then(function(b){a.AppointmentScheduler_AppointmentSchedulerList=b,a.BindAppoinetmentsToAppScheduler()})},a.ApptSchedView_GetPhysicianAndResourceList=function(){e.ApptSchedView_GetPhysicianAndResourceList().then(function(b){for(a.ApptSchedView_PhysiciansResourcesList=b,a.ElementIndex=0;a.ElementIndex<=a.ApptSchedView_PhysiciansResourcesList.length-1;a.ElementIndex++)if("1"==a.ApptSchedView_PhysiciansResourcesList[a.ElementIndex].IsDefaultDisplayAppointmentsForSec){a.apptSchedulerSelectedPhysicianName=a.ApptSchedView_PhysiciansResourcesList[a.ElementIndex].DoctorName,a.apptSchedulerSelectedPhysicianResourceID=a.ApptSchedView_PhysiciansResourcesList[a.ElementIndex].PhysicianId,a.apptSchedulerPhysicianOrResourceType="1"==a.ApptSchedView_PhysiciansResourcesList[a.ElementIndex].isResource?"2":"1";break}a.ApptSchedView_GetVisitingHoursAndBindAppointments()})},a.ApptSchedView_GetVisitingHoursAndBindAppointments=function(){e.ApptSchedView_GetVisitingHoursDetailsList(a.apptSchedulerSelectedPhysicianResourceID,a.apptSchedulerPhysicianOrResourceType).then(function(b){if(isError(b))return a.AppSchedView_ClearScheduler(),!1;if(a.ApptSchedView_VisitingHoursList=b,void 0==a.ApptSchedView_VisitingHoursList||a.ApptSchedView_VisitingHoursList.length<=0)return a.AppSchedView_ClearScheduler(),!1;for(a.ElementIndex=0;a.ElementIndex<=a.ApptSchedView_VisitingHoursList.length-1;a.ElementIndex++)if(a.ApptSchedView_VisitingHoursList[a.ElementIndex].ProviderID==a.apptSchedulerSelectedPhysicianResourceID&&a.ApptSchedView_VisitingHoursList[a.ElementIndex].WeekDayID==a.apptCurrentDate.getDay()){a.apptMinTime=a.ApptSchedView_VisitingHoursList[a.ElementIndex].OfficeStartTime,a.apptMaxTime=a.ApptSchedView_VisitingHoursList[a.ElementIndex].OfficeEndTime,a.apptSlotDuration=a.ApptSchedView_VisitingHoursList[a.ElementIndex].duration;break}a.ApptSchedView_GetPhysicianAppointments()})},a.ApptSchedView_onPhysicianMenuClick=function(b,c){if(a.apptSchedulerSelectedPhysicianResourceID=b,hasValue(c))a.apptSchedulerSelectedPhysicianName=c;else for(a.ElementIndex=0;a.ElementIndex<=a.ApptSchedView_PhysiciansResourcesList.length-1;a.ElementIndex++)if(a.ApptSchedView_PhysiciansResourcesList[a.ElementIndex].PhysicianId==b){a.apptSchedulerSelectedPhysicianName=a.ApptSchedView_PhysiciansResourcesList[a.ElementIndex].DoctorName;break}a.ApptSchedView_GetVisitingHoursAndBindAppointments()},a.ApptSchedView_onAddExistingPatientAppointment=function(b){f.OpenPopup(EMRApplicationPath+"Home/Index/49",null,"vlg").then(function(c){var d={SelectedPatient:c,SelectedDate:b,SelectedResourceType:a.apptSchedulerPhysicianOrResourceType,SelectedPhysicianID:a.apptSchedulerSelectedPhysicianResourceID};f.OpenPopup(EMRApplicationPath+"Home/Index/44",d,"vlg").then(function(b){isError(b.data)||a.ApptSchedView_GetPhysicianAppointments()})})},a.ApptSchedView_onAddnewAppointment=function(b){var c={SelectedDate:b,SelectedResourceType:a.apptSchedulerPhysicianOrResourceType,SelectedPhysicianID:a.apptSchedulerSelectedPhysicianResourceID};f.OpenPopup(EMRApplicationPath+"Home/Index/56",c,"vlg").then(function(b){isError(b.data)||a.ApptSchedView_GetPhysicianAppointments()})};var i;a.BindAppoinetmentsToAppScheduler=function(){void 0!=i&&a.AppSchedView_ClearScheduler(),a.apptDate=a.apptCurrentDate,a.apptView=a.apptCurrentView,a.apptEvents=a.AppointmentScheduler_AppointmentSchedulerList,a.ApptSchedView_DisplayDate()},a.ApptSchedView_openPatientChart=function(b){var c={patientID:b.PersonID,appointmentID:b.AppointmentID};a.$emit("HomeCtrl.openPatientChart",c)},a.ApptSchedView_PreviousClick=function(){a.apptCurrentDate.setDate("agendaDay"==a.apptCurrentView?a.apptCurrentDate.getDate()-1:a.apptStartDate.getDate()-1),a.ApptSchedView_GetVisitingHoursAndBindAppointments()},a.ApptSchedView_NextClick=function(){a.apptCurrentDate.setDate("agendaDay"==a.apptCurrentView?a.apptCurrentDate.getDate()+1:apptEndDate.getDate()+1),a.ApptSchedView_GetVisitingHoursAndBindAppointments()},a.ApptSchedView_TodayDayClick=function(){a.apptCurrentDate=new Date,a.ApptSchedView_GetPhysicianAppointments()},a.ApptSchedView_DayViewClick=function(){a.apptCurrentView="agendaDay",a.ApptSchedView_ActivateCurrentView($("#btnDay")),a.ApptSchedView_GetVisitingHoursAndBindAppointments()},a.ApptSchedView_WeekViewClick=function(){a.apptCurrentView="agendaWeek",a.ApptSchedView_ActivateCurrentView($("#btnWeek")),a.ApptSchedView_GetPhysicianAppointments()},a.ApptSchedView_MonthViewClick=function(){a.apptCurrentView="month",a.ApptSchedView_ActivateCurrentView($("#btnMonth")),a.ApptSchedView_GetPhysicianAppointments()},a.ApptSchedView_DisplayDate=function(){var b,c,d,e=a.apptCurrentDate,f=$.format.date(e,"E, MMM d, yyyy");"month"==a.apptCurrentView?f=$.format.date(e,"MMM, yyyy"):"agendaWeek"==a.apptCurrentView&&(b=e.getWeekStartAndEndDays(),c=b[0],d=b[1],f=$.format.date(c,"MMM d, yyyy")+" - "+$.format.date(d,"MMM d, yyyy")),$("#lblApptDisplayDate").html(f)},a.ApptSchedView_ActivateCurrentView=function(a){$("#btnDay").removeClass("fc-state-active"),$("#btnMonth").removeClass("fc-state-active"),$("#btnWeek").removeClass("fc-state-active"),a.addClass("fc-state-active")},a.AppSchedView_ClearScheduler=function(){h.fullCalendar("removeEvents"),h.fullCalendar("removeEventSources"),h.fullCalendar("destroy")},a.onAppointmentSlotClick=function(b,c){var d='<li><a href="" ng-click="ApptSchedView_onAddExistingPatientAppointment(\''+b+'\');">Add Existing Patient Appointment</a></li><li><a href="">Add New Patient Appointment</a></li>';openDrillDownMenuOnClick(g(d)(a),c)},a.onAppointmentCheckin=function(b){a.CheckInAppointment(b)},a.EditAppointment=function(b){if(void 0!=b){var c={apptid:b.AppointmentID,personid:b.PersonID,ScheduledInterval:apptSlotDuration};f.OpenPopup(EMRApplicationPath+"Home/Index/45",c,"lg").then(function(b){isError(b.data)||a.ApptSchedView_GetPhysicianAppointments()})}},a.CheckInAppointment=function(b){if(void 0!=b){var c={apptid:b.AppointmentID,personid:b.PersonID,AppointmentDate:new Date(b.start.format())};f.OpenPopup(EMRApplicationPath+"Home/Index/47",c,"lg").then(function(b){isError(b.data)||a.ApptSchedView_GetPhysicianAppointments()})}},a.CheckOutAppointment=function(b){if(void 0!=b){var c={apptid:b.AppointmentID,PatientID:b.PersonID,AppointmentDate:new Date(b.start.format())};void 0!=b.Notes&&1==b.Notes?f.OpenPopup(EMRApplicationPath+"Home/Index/52",c,"lg").then(function(){a.ApptSchedView_GetPhysicianAppointments()}):void 0!=b.Notes&&2==b.Notes&&f.OpenPopup(EMRApplicationPath+"Home/Index/50","Notes Not generated for this Appointment.Do you want to still check out","lg").then(function(b){return"NO"==b?!1:void("YES"==b&&f.OpenPopup(EMRApplicationPath+"Home/Index/53",c,"lg").then(function(){a.ApptSchedView_GetPhysicianAppointments()}))})}},a.CancelAppointment=function(b){if(void 0!=b){if(""!=b.CheckInTime)return void ShowErrorMessage("Patient Already checked In. Missed or cancel Appointment is not allowed.");if(1==b.Notes)return void ShowErrorMessage("Appointment is having notes, cannot be cancelled.");var c={apptid:b.AppointmentID,personid:b.PersonID};f.OpenPopup(EMRApplicationPath+"Home/Index/46",c,"sm").then(function(b){isError(b.data)||a.ApptSchedView_GetPhysicianAppointments()})}},a.SetMissedAppointment=function(b){if(void 0!=b){if(DateDiff.inDaysWithTime(b.start.format(),adminGetCurrentDateAndTime())<0)return void ShowErrorMessage("Missed Appointment cannot be given to future dates.");var c={AppointmentID:b.AppointmentID,WorkStationName:"V-EMRNC2"};e.SetMissedAppointment(c).then(function(b){isError(b)||a.ApptSchedView_GetPhysicianAppointments()})}},a.UndoCheckIn=function(b){if(void 0!=b){if(hasValue(b.CheckOutTime))return void ShowErrorMessage("Patient is already checked out. To undo check in please undo check out.");var c={AppointmentID:b.AppointmentID,WorkStationName:"V-EMRNC2"};e.UndoAppointmentCheckIn(c).then(function(b){isError(b)||a.ApptSchedView_GetPhysicianAppointments()})}},a.UndoCheckOut=function(b){if(void 0!=b){var c={AppointmentID:b.AppointmentID,WorkStationName:"V-EMRNC6"};e.UndoAppointmentCheckOut(c).then(function(b){isError(b)||a.ApptSchedView_GetPhysicianAppointments()})}},a.EditDemographics=function(b){if(void 0!=b){var c={PatientID:b.PersonID};f.OpenPopup(EMRApplicationPath+"Home/Index/5",c,"lg").then(function(b){isError(b.data)||a.ApptSchedView_GetPhysicianAppointments()})}},a.EditInsurancePolicies=function(b){if(void 0!=b){{({PatientID:b.PersonID,FirstName:b.FirstName,Lastname:b.LastName})}f.OpenPopup(EMRApplicationPath+"Home/Index/39",b,"lg").then(function(b){isError(b.data)||a.ApptSchedView_GetPhysicianAppointments()})}},a.$on("$destroy",function(){a.AppSchedView_ClearScheduler()})}]);